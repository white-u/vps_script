# Xray 多协议管理脚本 (x-sb.sh)

**版本**: v1.4.1 | **快捷命令**: `x-sb` | **安装路径**: `/usr/local/bin/x-sb`

---

## 1. 概述

`x-sb.sh` 是一个基于 **Xray-core** 的轻量级管理脚本。它专注于提供 **VLESS-Vision-REALITY** 和 **Shadowsocks-2022** 这两种高性能、抗封锁能力强的协议组合。

与臃肿的面板不同，`x-sb.sh` 坚持 **“最小化依赖、最大化性能”** 的原则，直接操作 JSON 配置文件，支持热重载，不依赖数据库。

### 1.1 核心特性

*   **协议支持:**
    *   **VLESS-Vision-REALITY:** 目前最先进的抗封锁协议，无需域名证书，自选 SNI (如 Microsoft/Apple)，速度极快。
    *   **Shadowsocks-2022:** 基于 BLAKE3 的新一代 SS 协议，在支持硬件加速的 CPU 上性能爆表。
*   **安全机制:**
    *   **配置回滚:** 每次修改配置前，先进行 JSON 语法校验和 Xray 语义校验。如果新配置导致服务无法启动，脚本会自动回滚到上一次的正确配置，防止失联。
    *   **端口随机:** 默认生成 10000-65535 的随机端口，避免特征扫描。
*   **进阶功能:**
    *   **链式代理 (Chain Proxy):** 支持为特定节点配置上游 SOCKS5 代理 (如 WARP/Clash)，实现落地 IP 优选或解锁流媒体。
    *   **路由规则:** 内置广告屏蔽 (Geosite: category-ads-all) 和 回国流量屏蔽 (Geoip: cn) 规则。

---

## 2. 安装与使用

### 2.1 一键安装

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/white-u/vps_script/main/x-sb.sh)
```

### 2.2 常用命令

| 命令 | 说明 |
|------|------|
| `x-sb` | 进入交互式管理菜单 (主入口) |
| `x-sb add` | 快速添加一个新节点 |
| `x-sb list` | 列出所有节点信息 |
| `x-sb update` | 更新管理脚本自身 |
| `x-sb install` | 强制重新安装/更新 Xray 核心 |

### 2.3 交互菜单

运行 `x-sb` 后可以看到如下界面：

```text
================================================================================
   Xray 多协议管理脚本 (v1.4.1)
================================================================================
 核心状态: ✅ 运行中 (v1.8.4)
 配置文件: /usr/local/etc/xray/config.json
--------------------------------------------------------------------------------
  1. 安装 / 更新 Xray 核心
  2. 添加 VLESS-Vision-Reality 节点 (⭐ 推荐)
  3. 添加 Shadowsocks-2022 节点 (🚀 性能)
  4. 查看节点配置 / 分享链接
  5. 删除节点
  6. 进阶配置 (链式代理 / 路由)
  7. 更新脚本
  8. 卸载脚本
  0. 退出
================================================================================
```

---

## 3. 节点类型详解

### 3.1 VLESS-Vision-REALITY

这是目前推荐的主力协议。
*   **原理:** 模拟 TLS 流量，将流量伪装成访问正常的 HTTPS 网站 (如 Microsoft.com)。
*   **优势:** 无需域名，无需申请证书，抗干扰能力极强，延迟低。
*   **配置项:**
    *   `SNI`: 目标网站域名 (脚本内置了几个大厂域名供选择)。
    *   `Private Key`: 脚本自动生成的 X25519 密钥。
    *   `Short ID`: 简短的随机字符串，用于抗重放攻击。

### 3.2 Shadowsocks-2022

适合对延迟极其敏感的游戏或即时通讯场景。
*   **原理:** 使用 AEAD-2022 算法加密流量。
*   **优势:** 协议开销极小，加解密速度极快。
*   **注意:** 建议配合 UDP 转发使用。

---

## 4. 进阶玩法：链式代理

`x-sb.sh` 支持配置 **Chain Proxy** (链式代理)。这意味着流量的路径变成了：

`客户端 -> VPS (Xray) -> 上游代理 (SOCKS5) -> 目标网站`

**应用场景:**
1.  **解锁 Netflix/ChatGPT:** VPS IP 被封锁，通过 WARP 或其他原生 IP 的 SOCKS5 代理转发流量。
2.  **隐藏 VPS IP:** 让目标网站只看到上游代理的 IP。

**配置方法:**
1.  在菜单中选择 `6. 进阶配置` -> `1. 配置上游 SOCKS5 代理`。
2.  输入上游代理地址 (如 `127.0.0.1:40000`)。
3.  在添加节点时，脚本会询问是否为此节点启用链式转发。选择 `y` 即可。

---

## 5. 文件路径

| 路径 | 用途 |
|------|------|
| `/usr/local/bin/xray` | Xray 核心二进制 |
| `/usr/local/etc/xray/config.json` | 主配置文件 |
| `/usr/local/share/xray/geoip.dat` | IP 数据库 |
| `/usr/local/share/xray/geosite.dat` | 域名数据库 |
| `/var/log/xray/access.log` | 访问日志 (默认关闭) |
| `/var/log/xray/error.log` | 错误日志 |

---

## 6. 卸载

在菜单中选择 `8. 卸载脚本`。
卸载会自动清理：
*   停止并禁用 Xray 服务。
*   删除 Systemd 服务文件。
*   删除配置文件目录 `/usr/local/etc/xray`。
*   删除数据文件目录 `/usr/local/share/xray`。
*   删除脚本自身。
